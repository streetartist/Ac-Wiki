{% if page.meta.comments %}
  <h2 id="__comments">{{ lang.t("meta.comments") }}</h2>
  <!-- Giscus 评论系统 -->
  <script
    src="https://giscus.app/client.js"
    data-repo="Ac-Wiki/Ac-Wiki"
    data-repo-id="R_kgDONCnJnA"
    data-category="Announcements"
    data-category-id="DIC_kwDONCnJnM4Cjk4S"
    data-mapping="title"
    data-strict="0"
    data-reactions-enabled="1"
    data-emit-metadata="1"
    data-input-position="top"
    data-theme="preferred_color_scheme"
    data-lang="zh-CN"
    data-loading="lazy"
    crossorigin="anonymous"
    async
  ></script>

  <!-- 用于同步 MkDocs 主题的脚本 -->
  <script>
    var giscus = document.querySelector("script[src*=giscus]");

    // 监听主题切换事件
    var observer = new MutationObserver(function() {
      var theme = document.body.getAttribute("data-md-color-scheme") === "slate"
        ? "dark_dimmed" // Giscus 的暗黑主题
        : "light";      // Giscus 的白天主题

      // 向 Giscus iframe 发送消息以更新主题
      var iframe = document.querySelector("iframe.giscus-frame");
      if (iframe) {
        iframe.contentWindow.postMessage(
          { giscus: { setConfig: { theme: theme } } },
          "https://giscus.app"
        );
      }
    });

    // 开始监听 body 元素上的属性变化
    observer.observe(document.body, {
      attributes: true,
      attributeFilter: ["data-md-color-scheme"]
    });
  </script>
{% endif %}